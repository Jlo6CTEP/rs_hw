from numpy import eye as I, zeros as Z, arange, block

from Helpers.helpers import robot_stiffnesses, stiff_rot, get_k11, get_k12, get_k21


def get_kc_msa(axis, q_1, q_2):
    axis_selector = {'rx': [3, 3], 'ry': [4, 4], 'rz': [5, 5]}

    Lr = I(6)
    Lr[axis_selector[axis]] = 0
    Lr_s = Lr[arange(6) != axis_selector[axis][0]]

    Lp_s = Z([6])
    Lp_s[axis_selector[axis][0]] = 1

    K0, K1, K2 = robot_stiffnesses()

    K1_22 = K0
    K1_11 = get_k11(K0, axis)
    K1_12 = get_k12(K1_22, axis)
    K1_21 = get_k21(K1_11, axis)

    K2_22 = stiff_rot(K1, axis, q_1)
    K2_11 = stiff_rot(get_k11(K1, axis), axis, q_1)
    K2_12 = stiff_rot(get_k12(K2_22, axis), axis, q_1)
    K2_21 = stiff_rot(get_k21(K2_11, axis), axis, q_1)

    K3_22 = stiff_rot(K2, axis, q_1 + q_2)
    K3_11 = stiff_rot(get_k11(K2, axis), axis, q_1 + q_2)
    K3_12 = stiff_rot(get_k12(K3_22, axis), axis, q_1 + q_2)
    K3_21 = stiff_rot(get_k21(K3_11, axis), axis, q_1 + q_2)

    A = block([[Lr_s,       -Lr_s,      Z([5, 6]),  Z([5, 6])],
               [Z([5, 6]),  Z([5, 6]),  Lr_s,       -Lr_s],
               [Lr_s@K1_22, Lr_s@K2_11, Lr_s@K2_12, Z([5, 6])],
               [Z([5, 6]),  Lr_s@K2_21, Lr_s@K2_22, Lr_s@K3_11],
               [Lp_s@K1_22, Z([1, 6]),  Z([1, 6]),  Z([1, 6])],
               [Z([1, 6]),  Lp_s@K2_11, Lp_s@K2_12, Z([1, 6])],
               [Z([1, 6]),  Lp_s@K2_21, Lp_s@K2_22, Z([1, 6])],
               [Z([1, 6]),  Z([1, 6]),  Z([1, 6]),  Lp_s@K3_11]])
    
    Ap = block([[Lr_s,          -Lr_s],
                [Lp_s@K1_22,    Z([1, 6])],
                [Z([1, 6]), Lp_s@K2_11],
                [Lr_s@K1_22,    Lr_s@K2_11]])
    
    B = block([[Z([5, 6])],
               [Z([5, 6])],
               [Z([5, 6])],
               [Lr_s@K3_12],
               [Z([1, 6])],
               [Z([1, 6])],
               [Z([1, 6])],
               [Lp_s@K3_12]])
    
    C = block([Z([6, 6]), Z([6, 6]), Z([6, 6]), K3_21])
    D = K3_22

    A = block([[I(6),      Z([6, 6]), Z([6, 6]), Z([6, 6]), Z([6, 6]), Z([6, 6]), K1_11,     K1_12,     Z([6, 6]), Z([6, 6]), Z([6, 6])],
               [Z([6, 6]), I(6),      Z([6, 6]), Z([6, 6]), Z([6, 6]), Z([6, 6]), K1_21,     K1_22,     Z([6, 6]), Z([6, 6]), Z([6, 6])],
               [Z([6, 6]), Z([6, 6]), I(6),      Z([6, 6]), Z([6, 6]), Z([6, 6]), Z([6, 6]), Z([6, 6]), K2_11,     K2_12,     Z([6, 6])],
               [Z([6, 6]), Z([6, 6]), I(6),      Z([6, 6]), Z([6, 6]), Z([6, 6]), Z([6, 6]), Z([6, 6]), K2_21,     K2_22,     Z([6, 6])],
               [Z([6, 6]), Z([6, 6]), Z([6, 6]), I(6),      Z([6, 6]), Z([6, 6]), Z([6, 6]), Z([6, 6]), Z([6, 6]), Z([6, 6]), K3_11],
               [Z([6, 6]), Z([6, 6]), Z([6, 6]), Z([6, 6]), I(6),      Z([6, 6]), Z([6, 6]), Z([6, 6]), Z([6, 6]), Z([6, 6]), K3_21],
               [Z([6, 6]), Z([6, 6]), Z([6, 6]), Z([6, 6]), Z([6, 6]), Z([6, 6]), I(6),      Z([6, 6]), Z([6, 6]), Z([6, 6]), Z([6, 6])],
               [Z([5, 6]), Z([5, 6]), Z([5, 6]), Z([5, 6]), Z([5, 6]), Z([5, 6]), Z([5, 6]), Lr_s,      -Lr_s,     Z([5, 6]), Z([5, 6])],
               [Z([5, 6]), Z([5, 6]), Z([5, 6]), Z([5, 6]), Z([5, 6]), Z([5, 6]), Z([5, 6]), Z([5, 6]), Z([5, 6]), Lr_s,      -Lr_s],
               [Z([1, 6]), Lp_s,      Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6])],
               [Z([1, 6]), Z([1, 6]), Lp_s,      Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6])],
               [Z([1, 6]), Z([1, 6]), Z([1, 6]), Lp_s,      Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6])],
               [Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6]), Lp_s,      Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6]), Z([1, 6])],
               [Z([5, 6]), Lr_s,      Lr_s,      Z([5, 6]), Z([5, 6]), Z([5, 6]), Z([5, 6]), Z([5, 6]), Z([5, 6]), Z([5, 6]), Z([5, 6])],
               [Z([5, 6]), Z([5, 6]), Z([5, 6]), Lr_s,      Lr_s,      Z([5, 6]), Z([5, 6]), Z([5, 6]), Z([5, 6]), Z([5, 6]), Z([5, 6])],
               ])



    #Kc = D - C @ inv(A) @ B
    print()
    print()
    return 1
